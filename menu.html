<!DOCTYPE html>
<html lang="ru" ng-app="menuApp" class="dark">
<head>
  <meta charset="UTF-8" />
  <title>–ú–µ–Ω—é</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body ng-controller="MenuController" class="bg-gray-900 text-white p-4 font-sans">
  <h1 class="text-2xl mb-4">–ú–µ–Ω—é</h1>

  <div ng-if="dishes.length === 0" class="text-gray-400">–ü–æ–∫–∞ —á—Ç–æ –ø—É—Å—Ç–æ.</div>

  <div ng-repeat="dish in dishes track by $index"
       class="bg-gray-800 p-4 rounded-lg mb-3 flex justify-between items-center">
    <div class="flex items-center space-x-4">
      <img ng-if="dish.image" ng-src="{{dish.image}}" class="w-16 h-16 object-cover rounded" />
      <div>
        <p class="text-lg font-semibold">{{dish.name}}</p>
        <p class="text-gray-400">{{dish.price}}</p>
      </div>
    </div>

    <div class="flex items-center space-x-2">
      <button ng-if="dish.count > 0"
              ng-click="dish.count = dish.count - 1"
              class="bg-red-600 hover:bg-red-700 text-white px-2 rounded">-</button>
      <span ng-if="dish.count > 0">{{dish.count}}</span>
      <button ng-click="dish.count = (dish.count || 0) + 1"
              class="bg-green-600 hover:bg-green-700 text-white px-2 rounded">+</button>
    </div>
  </div>

  <button ng-click="submitOrder()"
          class="w-full mt-6 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded text-lg">
    –ó–∞–∫–∞–∑–∞—Ç—å
  </button>

  <script>
    angular.module("menuApp", []).controller("MenuController", function ($scope) {
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –±–ª—é–¥–∞ –∏–∑ localStorage (–¥–µ–≤—É—à–∫–∞ –∏—Ö –¥–æ–±–∞–≤–∏–ª–∞ –≤ –∞–¥–º–∏–Ω–∫–µ)
      $scope.dishes = JSON.parse(localStorage.getItem('dishes') || '[]');

      $scope.submitOrder = function () {
        const order = $scope.dishes
          .filter(d => d.count > 0)
          .map(d => ({
            name: d.name,
            count: d.count,
            price: d.price // üëà –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤–∫–ª—é—á–∞–µ–º
          }));
      
        if (order.length === 0) {
          alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –±–ª—é–¥–æ");
          return;
        }
      
        const tg = window.Telegram.WebApp;
        tg.sendData(JSON.stringify(order));
      
        // –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É
        $scope.dishes.forEach(d => d.count = 0);
        $scope.$apply();
      };
    });
  </script>
</body>
</html>
