<!DOCTYPE html>
<html lang="ru" ng-app="adminApp" class="dark">
<head>
  <meta charset="UTF-8" />
  <title>Админ-панель</title>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Скрыть настоящий input для загрузки файла */
    .file-input {
      @apply hidden;
    }
  </style>
</head>
<body ng-controller="AdminController" class="bg-gray-900 text-white p-6 font-sans">

  <h1 class="text-2xl mb-4">Добавить блюдо</h1>

  <div class="space-y-2 mb-6">
    <input ng-model="newDish.name" placeholder="Название блюда"
      class="w-full p-2 bg-gray-800 border border-gray-700 rounded text-white" />

    <input ng-model="newDish.price" placeholder="Цена (текстом или числом)"
      class="w-full p-2 bg-gray-800 border border-gray-700 rounded text-white" />

    <label class="block w-full cursor-pointer bg-gray-800 border border-gray-700 rounded text-center py-2 hover:bg-gray-700 transition relative overflow-hidden">
      <span class="block">Загрузить фото блюда</span>
      <div ng-if="newDish.image" class="mt-2">
        <img ng-src="{{newDish.image}}" alt="Превью" class="w-24 h-24 object-cover rounded border border-gray-700" />
      </div>

      <input type="file" accept="image/*"
             class="absolute inset-0 opacity-0 cursor-pointer"
             onchange="angular.element(this).scope().uploadPhoto(event)">
    </label>

    <button ng-click="addDish()"
      class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded w-full mt-2">Добавить блюдо</button>
  </div>

  <h2 class="text-xl mb-2">Текущее меню:</h2>
  <div ng-if="dishes.length === 0" class="text-gray-400">Нет добавленных блюд</div>

  <div ng-repeat="dish in dishes track by $index"
       class="relative bg-gray-800 p-4 rounded-lg mb-3 group hover:shadow-xl transition">
    <div class="flex items-center space-x-4">
      <img ng-if="dish.image" ng-src="{{dish.image}}" alt="Фото" class="w-16 h-16 object-cover rounded" />
      <div class="flex-1">
        <p class="text-lg font-semibold">{{dish.name}}</p>
        <p class="text-gray-400">{{dish.price}}</p>
      </div>
    </div>

    <!-- Кнопка удаления при наведении -->
    <button ng-click="deleteDish($index)"
            class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-xs">
      Удалить
    </button>
  </div>

  <script>
    angular.module("adminApp", []).controller("AdminController", function ($scope) {
      $scope.dishes = JSON.parse(localStorage.getItem('dishes') || '[]');
      $scope.newDish = {};

      $scope.uploadPhoto = function (event) {
        const input = event.target;
        const reader = new FileReader();
        reader.onload = function (e) {
          $scope.$apply(function () {
            $scope.newDish.image = e.target.result;
            input.value = null; // <-- здесь сброс file input
          });
        };
        reader.readAsDataURL(input.files[0]);
      };


      $scope.addDish = function () {
        if (!$scope.newDish.name || !$scope.newDish.price) return;
        $scope.dishes.push({
          name: $scope.newDish.name,
          price: $scope.newDish.price,
          image: $scope.newDish.image || null
        });
        localStorage.setItem('dishes', JSON.stringify($scope.dishes));
        $scope.newDish = {};
        event.target.value = null; // сброс input[type=file]
      };

      $scope.deleteDish = function (index) {
        $scope.dishes.splice(index, 1);
        localStorage.setItem('dishes', JSON.stringify($scope.dishes));
      };
    });
  </script>
</body>
</html>
